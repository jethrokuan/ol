<% title "Edit "+@subject.subject%>
<div class="row">
	<nav class="span3">
      <%=render partial: 'shared/logo'%>
      <ul data-spy="affix" class="nav nav-pills nav-stacked hidden-phone">
        <%=render partial: 'shared/start'%>
        <%=render partial: "shared/navmanage"%>
        <%=render partial: "shared/last"%>
      </ul>
  </nav><!--span3-->
	<div class="span8 offset1">
	<h1><%=@subject.subject%></h1>
	<p class="lead"><%=@subject.checkpoints.count%> checkpoints in <%=@subject.lessons.count%> lessons</p>
	<hr>
		<%=render partial: "shared/manage"%>
	<hr>
	<%@subject.topics.each do |topic|%>
		<h3><%=topic.topic%> <small><a href=<%=edit_topic_path(topic)%> role="button" data-toggle="modal" class="salmon">(EDIT)</a></small></h3>
		<h6><small><%=topic.description%></small></h6>
		<ol>
			<%topic.lessons.each do |lesson|%>
			<%if lesson.is_sublesson%>
				<ul class="unstyled">
					<li><%=lesson.lesson%><a href=<%=edit_lesson_path(lesson)%> role="button" data-toggle="modal" class="salmon">(EDIT)</a></small></li>
					<ul class="unstyled">
					<%lesson.checkpoints.each do |checkpoint|%>
						<li class="lesson" draggable="true"><i class="icon-sort"></i><%=link_to checkpoint.checkpoint, checkpoint%></li>
					<%end%>
					</ul>
				</ul>
				<%else%>
				<li><%=lesson.lesson%><a href=<%=edit_lesson_path(lesson)%> role="button" data-toggle="modal" class="salmon">(EDIT)</a></small></li>
				<ul class="unstyled">
					<%lesson.checkpoints.each do |checkpoint|%>
						<li class="lesson" draggable="true"><i class="icon-sort"></i><%=link_to checkpoint.checkpoint, checkpoint%></li>
					<%end%>
					</ul>
				<%end%>
			<%end%>
		</ol>
		<hr>
	<%end%>
	<%=render partial: "shared/manage"%>
	</div><!--span8-->
	</div><!--row-->

<script>
function handleDragOver(e) {
  if (e.preventDefault) {
    e.preventDefault(); // Necessary. Allows us to drop.
  }

  e.dataTransfer.dropEffect = 'move';  // See the section on the DataTransfer object.

  return false;
}
var dragSrcEl = null;
function handleDragStart(e) {
  dragSrcEl = this;

  e.dataTransfer.effectAllowed = 'move';
  e.dataTransfer.setData('text/html', this.innerHTML);
}
function handleDrop(e) {
  if (e.stopPropagation) {
    e.stopPropagation();
  }
  if (dragSrcEl != this) {
    dragSrcEl.innerHTML = this.innerHTML;
    this.innerHTML = e.dataTransfer.getData('text/html');
  }

  return false;
}
var cols = document.querySelectorAll('.lesson');
[].forEach.call(cols, function(col) {
  col.addEventListener('dragstart', handleDragStart, false);
  col.addEventListener('dragover', handleDragOver, false);
  col.addEventListener('drop', handleDrop, false);
});
</script>